# 18. this 指向的规则是什么？

**答案：**

**this 指向规则：**

```javascript
// 1. 默认绑定（严格模式下为 undefined，非严格模式为 window）
function fn() {
  console.log(this);
}

fn(); // window (非严格模式) / undefined (严格模式)

// 2. 隐式绑定（谁调用就指向谁）
const obj = {
  name: 'Alice',
  sayName: function() {
    console.log(this.name);
  }
};

obj.sayName(); // "Alice" (this 指向 obj)

const fn = obj.sayName;
fn(); // undefined (this 指向 window)

// 3. 显式绑定（call、apply、bind）
function greet() {
  console.log(`Hello, ${this.name}`);
}

const person = { name: 'Alice' };

greet.call(person); // "Hello, Alice"
greet.apply(person); // "Hello, Alice"
const boundGreet = greet.bind(person);
boundGreet(); // "Hello, Alice"

// 4. new 绑定（指向新创建的对象）
function Person(name) {
  this.name = name;
}

const person = new Person('Alice');
console.log(person.name); // "Alice"

// 5. 箭头函数（继承外层作用域的 this）
const obj = {
  name: 'Alice',
  sayName: () => {
    console.log(this.name); // undefined (this 指向全局)
  },
  
  sayName2: function() {
    const arrow = () => {
      console.log(this.name); // "Alice" (继承外层 this)
    };
    arrow();
  }
};

obj.sayName();
obj.sayName2();
```

**场景题：**

```javascript
// 场景 1：事件处理器
const button = document.getElementById('button');

// ❌ 错误：this 指向 button 元素
button.addEventListener('click', function() {
  console.log(this); // button 元素
});

// ✅ 正确：使用箭头函数
const obj = {
  name: 'Alice',
  handleClick: function() {
    console.log(this.name); // "Alice"
  }
};

button.addEventListener('click', () => {
  obj.handleClick();
});

// 场景 2：回调函数
const obj = {
  name: 'Alice',
  greet: function() {
    setTimeout(function() {
      console.log(this.name); // undefined
    }, 100);
  },
  
  greet2: function() {
    setTimeout(() => {
      console.log(this.name); // "Alice"
    }, 100);
  }
};

// 场景 3：构造函数
function Person(name) {
  this.name = name;
}

Person.prototype.greet = function() {
  console.log(`Hello, ${this.name}`);
};

const person = new Person('Alice');
person.greet(); // "Hello, Alice"

// 场景 4：call、apply、bind 的区别
function add(a, b) {
  return a + b;
}

console.log(add.call(null, 1, 2)); // 3
console.log(add.apply(null, [1, 2])); // 3
const add1 = add.bind(null, 1);
console.log(add1(2)); // 3
```

---