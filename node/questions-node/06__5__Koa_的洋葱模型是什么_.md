## 5. Koa 的洋葱模型是什么？

**答案：**

Koa 的洋葱模型是其核心设计之一，用于实现中间件的执行流程。中间件形成像洋葱一样层层包裹的结构，请求和响应在中间件之间层层传递。

### 洋葱模型示例

```javascript
const Koa = require('koa');
const app = new Koa();

app.use(async (ctx, next) => {
  console.log('1. 请求进入中间件 1');
  await next();
  console.log('1. 响应离开中间件 1');
});

app.use(async (ctx, next) => {
  console.log('2. 请求进入中间件 2');
  await next();
  console.log('2. 响应离开中间件 2');
});

app.use(async ctx => {
  console.log('3. 处理请求');
  ctx.body = 'Hello World';
});

app.listen(3000);

// 输出：
// 1. 请求进入中间件 1
// 2. 请求进入中间件 2
// 3. 处理请求
// 2. 响应离开中间件 2
// 1. 响应离开中间件 1
```

### 洋葱模型图示

```
┌─────────────────────────────────────────┐
│         中间件 1                         │
│  ┌───────────────────────────────────┐  │
│  │         中间件 2                   │  │
│  │  ┌─────────────────────────────┐  │  │
│  │  │         中间件 3             │  │  │
│  │  │         处理请求             │  │  │
│  │  └─────────────────────────────┘  │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
```

---