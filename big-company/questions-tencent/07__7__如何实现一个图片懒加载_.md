# 7. 如何实现一个图片懒加载？

**答案：**

```javascript
// 使用 Intersection Observer API
class LazyImage extends React.Component {
  constructor(props) {
    super(props);
    this.imgRef = React.createRef();
    this.state = {
      loaded: false,
      inView: false
    };
  }
  
  componentDidMount() {
    this.observer = new IntersectionObserver(
      (entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            this.setState({ inView: true });
            this.observer.unobserve(entry.target);
          }
        });
      },
      {
        rootMargin: '100px' // 提前 100px 加载
      }
    );
    
    if (this.imgRef.current) {
      this.observer.observe(this.imgRef.current);
    }
  }
  
  componentWillUnmount() {
    if (this.observer) {
      this.observer.disconnect();
    }
  }
  
  render() {
    const { src, alt, placeholder } = this.props;
    const { loaded, inView } = this.state;
    
    return (
      <img
        ref={this.imgRef}
        src={inView && loaded ? src : placeholder}
        alt={alt}
        onLoad={() => this.setState({ loaded: true })}
        style={{
          opacity: loaded ? 1 : 0.5,
          transition: 'opacity 0.3s'
        }}
      />
    );
  }
}

// 使用
<LazyImage
  src="https://example.com/image.jpg"
  alt="图片"
  placeholder="https://example.com/placeholder.jpg"
/>
```

---
