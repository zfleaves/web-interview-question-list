# 2. 如何实现一个前端日志系统？

**答案：**

```javascript
// 日志系统实现
class Logger {
  constructor(options = {}) {
    this.level = options.level || 'info';
    this.levels = {
      debug: 0,
      info: 1,
      warn: 2,
      error: 3,
    };
    this.handlers = options.handlers || [];
    this.context = options.context || {};
  }
  
  // 设置日志级别
  setLevel(level) {
    this.level = level;
  }
  
  // 添加处理器
  addHandler(handler) {
    this.handlers.push(handler);
  }
  
  // 设置上下文
  setContext(context) {
    this.context = { ...this.context, ...context };
  }
  
  // 记录日志
  log(level, message, meta = {}) {
    if (this.levels[level] < this.levels[this.level]) {
      return;
    }
    
    const logEntry = {
      timestamp: new Date().toISOString(),
      level,
      message,
      context: { ...this.context },
      meta,
    };
    
    this.handlers.forEach(handler => {
      handler(logEntry);
    });
  }
  
  debug(message, meta) {
    this.log('debug', message, meta);
  }
  
  info(message, meta) {
    this.log('info', message, meta);
  }
  
  warn(message, meta) {
    this.log('warn', message, meta);
  }
  
  error(message, meta) {
    this.log('error', message, meta);
  }
}

// 控制台处理器
function consoleHandler(entry) {
  const { timestamp, level, message, meta } = entry;
  const prefix = `[${timestamp}] [${level.toUpperCase()}]`;
  
  switch (level) {
    case 'debug':
      console.debug(prefix, message, meta);
      break;
    case 'info':
      console.info(prefix, message, meta);
      break;
    case 'warn':
      console.warn(prefix, message, meta);
      break;
    case 'error':
      console.error(prefix, message, meta);
      break;
  }
}

// 远程处理器
function remoteHandler(url) {
  const queue = [];
  let timer = null;
  
  return function(entry) {
    queue.push(entry);
    
    if (!timer) {
      timer = setTimeout(() => {
        fetch(url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(queue),
        }).catch(err => {
          console.error('日志上报失败:', err);
        });
        
        queue.length = 0;
        timer = null;
      }, 1000);
    }
  };
}

// 使用
const logger = new Logger({
  level: 'debug',
  handlers: [
    consoleHandler,
    remoteHandler('https://logs.example.com/api/logs'),
  ],
  context: {
    app: 'MyApp',
    version: '1.0.0',
  },
});
```

---

## 算法题
