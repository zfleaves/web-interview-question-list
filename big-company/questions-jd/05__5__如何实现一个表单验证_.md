# 5. 如何实现一个表单验证？

**答案：**

```javascript
class FormValidator {
  constructor(rules = {}) {
    this.rules = rules;
    this.errors = {};
  }
  
  // 添加验证规则
  addRule(field, rule) {
    if (!this.rules[field]) {
      this.rules[field] = [];
    }
    this.rules[field].push(rule);
  }
  
  // 验证单个字段
  validateField(field, value) {
    const fieldRules = this.rules[field];
    if (!fieldRules) {
      return [];
    }
    
    const errors = [];
    
    for (const rule of fieldRules) {
      const result = rule.validator(value);
      if (!result.valid) {
        errors.push(rule.message);
      }
    }
    
    return errors;
  }
  
  // 验证整个表单
  validate(data) {
    this.errors = {};
    let isValid = true;
    
    for (const field in this.rules) {
      const fieldErrors = this.validateField(field, data[field]);
      if (fieldErrors.length > 0) {
        this.errors[field] = fieldErrors;
        isValid = false;
      }
    }
    
    return isValid;
  }
  
  // 获取错误信息
  getErrors() {
    return this.errors;
  }
  
  // 清除错误
  clearErrors() {
    this.errors = {};
  }
}

// 使用
const validator = new FormValidator({
  username: [
    {
      validator: (value) => ({
        valid: value && value.length >= 3,
      }),
      message: '用户名至少3个字符',
    },
    {
      validator: (value) => ({
        valid: /^[a-zA-Z0-9_]+$/.test(value),
      }),
      message: '用户名只能包含字母、数字和下划线',
    },
  ],
  email: [
    {
      validator: (value) => ({
        valid: /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value),
      }),
      message: '邮箱格式不正确',
    },
  ],
});

const formData = {
  username: 'ab',
  email: 'invalid-email',
};

const isValid = validator.validate(formData);
if (!isValid) {
  console.log(validator.getErrors());
  // {
  //   username: ['用户名至少3个字符'],
  //   email: ['邮箱格式不正确']
  // }
}
```
