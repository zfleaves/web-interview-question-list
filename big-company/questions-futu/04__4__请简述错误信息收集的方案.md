# 4. 请简述错误信息收集的方案

**答案：**

**错误信息收集包括即时运行错误和资源加载错误的捕获。**

**即时运行错误捕获：**

```javascript
// 1. try...catch
try {
  // 可能出错的代码
  JSON.parse(invalidJson);
} catch (error) {
  reportError(error);
}

// 2. window.onerror
window.onerror = function(message, source, lineno, colno, error) {
  reportError({
    message,
    source,
    lineno,
    colno,
    error
  });
};

// 3. Vue 组件 errorCaptured
export default {
  errorCaptured(err, vm, info) {
    reportError({
      error: err,
      component: vm.$options.name,
      info
    });
  }
};
```

**资源加载错误捕获：**

```javascript
// 1. object.onerror 事件
const img = new Image();
img.onerror = function() {
  reportError({
    type: 'image_load_error',
    src: this.src
  });
};
img.src = 'image.jpg';

// 2. performance.getEntries()
const entries = performance.getEntries();
entries.forEach(entry => {
  if (entry.duration === 0 && entry.transferSize === 0) {
    reportError({
      type: 'resource_load_error',
      name: entry.name
    });
  }
});

// 3. Error 事件捕获
window.addEventListener('error', function(e) {
  if (e.target !== window) {
    reportError({
      type: 'resource_error',
      target: e.target.tagName,
      src: e.target.src
    });
  }
}, true);
```

**错误上报方式：**

```javascript
// 1. Ajax 上报
function reportError(error) {
  fetch('/api/error', {
    method: 'POST',
    body: JSON.stringify(error)
  });
}

// 2. Image 对象上报
function reportError(error) {
  const img = new Image();
  img.src = `http://api.example.com/error?data=${encodeURIComponent(JSON.stringify(error))}`;
}

// 3. 使用 Sentry
import * as Sentry from '@sentry/browser';

Sentry.init({
  dsn: 'your-dsn'
});

Sentry.captureException(error);
```

**富途特色考点：**
- 富途高频考察错误监控和上报方案
- 结合金融业务说明错误收集的重要性
- 考察对 Sentry 等监控工具的使用经验

---
