# 13. 实现图片懒加载

**答案：**

```javascript
class LazyImage {
  constructor(options = {}) {
    this.options = {
      rootMargin: '100px',
      threshold: 0.1,
      ...options
    };
    
    this.observer = new IntersectionObserver(
      this.handleIntersect.bind(this),
      this.options
    );
  }
  
  observe(element) {
    this.observer.observe(element);
  }
  
  handleIntersect(entries) {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const img = entry.target;
        const src = img.dataset.src;
        
        if (src) {
          img.src = src;
          img.onload = () => {
            img.classList.add('loaded');
          };
          img.onerror = () => {
            img.classList.add('error');
          };
        }
        
        this.observer.unobserve(img);
      }
    });
  }
}

// 使用
const lazyImage = new LazyImage({
  rootMargin: '100px',
  threshold: 0.1
});

document.querySelectorAll('img[data-src]').forEach(img => {
  lazyImage.observe(img);
});
```

**HTML：**

```html
<img src="placeholder.jpg" data-src="real-image.jpg" loading="lazy" alt="图片">

<style>
img {
  opacity: 0;
  transition: opacity 0.3s;
}

img.loaded {
  opacity: 1;
}

img.error {
  opacity: 0.5;
}
</style>
```

**富途特色考点：**
- 富途高频考察性能优化技术
- 结合实际项目说明懒加载的应用场景
- 考察对 IntersectionObserver API 的使用

---
