# 5. 请简述跨域问题及解决方案

**答案：**

**跨域是指浏览器限制从一个域名的网页去请求另一个域名的资源。**

**为什么要有同源策略？**
- 防止恶意网站读取其他网站的敏感信息
- 保护用户隐私和安全
- 防止 CSRF 攻击

**解决方案：**

**1. JSONP**

```javascript
function jsonp(url, callbackName) {
  return new Promise((resolve, reject) => {
    const script = document.createElement('script');
    script.src = `${url}?callback=${callbackName}`;
    
    window[callbackName] = function(data) {
      resolve(data);
      delete window[callbackName];
      document.body.removeChild(script);
    };
    
    script.onerror = () => {
      reject(new Error('JSONP request failed'));
    };
    
    document.body.appendChild(script);
  });
}

// 使用
jsonp('http://api.example.com/data', 'callback')
  .then(data => console.log(data));
```

**2. CORS（跨域资源共享）**

```javascript
// 前端
fetch('http://api.example.com/data', {
  method: 'GET',
  headers: {
    'Content-Type': 'application/json'
  },
  credentials: 'include' // 携带 cookie
})
  .then(res => res.json())
  .then(data => console.log(data));

// 后端（Node.js）
app.use((req, res, next) => {
  res.header('Access-Control-Allow-Origin', 'http://localhost:3000');
  res.header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE');
  res.header('Access-Control-Allow-Headers', 'Content-Type, Authorization');
  res.header('Access-Control-Allow-Credentials', 'true');
  next();
});
```

**3. postMessage**

```javascript
// 窗口 A
const iframe = document.getElementById('iframe');
iframe.contentWindow.postMessage('Hello from A', 'http://b.com');

// 窗口 B
window.addEventListener('message', function(e) {
  if (e.origin === 'http://a.com') {
    console.log('收到消息:', e.data);
  }
});
```

**4. WebSocket**

```javascript
const ws = new WebSocket('ws://api.example.com');

ws.onopen = function() {
  console.log('连接已建立');
};

ws.onmessage = function(e) {
  console.log('收到消息:', e.data);
};

ws.send('Hello from client');
```

**5. 代理服务器**

```javascript
// webpack.config.js
module.exports = {
  devServer: {
    proxy: {
      '/api': {
        target: 'http://api.example.com',
        changeOrigin: true,
        pathRewrite: {
          '^/api': ''
        }
      }
    }
  }
};
```

**富途特色考点：**
- 富途高频考察跨域问题的理解和解决方案
- 结合实际项目说明跨域场景的处理
- 考察对浏览器安全机制的理解

---
