# 4. 实现一个节流函数

**答案：**

```javascript
// 基础节流
function throttle(fn, delay) {
  let lastCall = 0;
  
  return function(...args) {
    const now = Date.now();
    
    if (now - lastCall >= delay) {
      fn.apply(this, args);
      lastCall = now;
    }
  };
}

// 支持立即执行和尾随调用
function throttle(fn, delay, options = {}) {
  const { leading = true, trailing = true } = options;
  let timer = null;
  let lastCall = 0;
  
  return function(...args) {
    const now = Date.now();
    const context = this;
    
    // 首次调用
    if (!lastCall && !leading) {
      lastCall = now;
    }
    
    const remaining = delay - (now - lastCall);
    
    if (remaining <= 0) {
      if (timer) {
        clearTimeout(timer);
        timer = null;
      }
      
      lastCall = now;
      fn.apply(context, args);
    } else if (!timer && trailing) {
      timer = setTimeout(() => {
        lastCall = leading ? Date.now() : 0;
        timer = null;
        fn.apply(context, args);
      }, remaining);
    }
  };
}

// 使用示例
const throttledScroll = throttle(function() {
  console.log('滚动事件');
}, 100);

window.addEventListener('scroll', throttledScroll);
```

---

## 场景题
