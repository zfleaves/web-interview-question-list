# 8. 如何实现一个前端缓存系统？

**答案：**

```javascript
class CacheSystem {
  constructor(options = {}) {
    this.options = {
      storage: 'localStorage',
      prefix: 'cache_',
      ttl: 3600000,
      ...options
    };
    
    this.cache = new Map();
    this.init();
  }
  
  init() {
    if (this.options.storage === 'localStorage') {
      this.loadFromStorage();
    }
  }
  
  set(key, value, ttl = this.options.ttl) {
    const item = {
      value,
      expire: Date.now() + ttl
    };
    
    if (this.options.storage === 'localStorage') {
      localStorage.setItem(this.options.prefix + key, JSON.stringify(item));
    } else if (this.options.storage === 'sessionStorage') {
      sessionStorage.setItem(this.options.prefix + key, JSON.stringify(item));
    } else {
      this.cache.set(key, item);
    }
  }
  
  get(key) {
    let item;
    
    if (this.options.storage === 'localStorage') {
      const data = localStorage.getItem(this.options.prefix + key);
      item = data ? JSON.parse(data) : null;
    } else if (this.options.storage === 'sessionStorage') {
      const data = sessionStorage.getItem(this.options.prefix + key);
      item = data ? JSON.parse(data) : null;
    } else {
      item = this.cache.get(key);
    }
    
    if (item && item.expire < Date.now()) {
      this.delete(key);
      return null;
    }
    
    return item ? item.value : null;
  }
  
  delete(key) {
    if (this.options.storage === 'localStorage') {
      localStorage.removeItem(this.options.prefix + key);
    } else if (this.options.storage === 'sessionStorage') {
      sessionStorage.removeItem(this.options.prefix + key);
    } else {
      this.cache.delete(key);
    }
  }
  
  clear() {
    if (this.options.storage === 'localStorage') {
      const keys = Object.keys(localStorage);
      keys.forEach(key => {
        if (key.startsWith(this.options.prefix)) {
          localStorage.removeItem(key);
        }
      });
    } else if (this.options.storage === 'sessionStorage') {
      const keys = Object.keys(sessionStorage);
      keys.forEach(key => {
        if (key.startsWith(this.options.prefix)) {
          sessionStorage.removeItem(key);
        }
      });
    } else {
      this.cache.clear();
    }
  }
  
  cleanup() {
    const now = Date.now();
    
    if (this.options.storage === 'localStorage') {
      const keys = Object.keys(localStorage);
      keys.forEach(key => {
        if (key.startsWith(this.options.prefix)) {
          const data = localStorage.getItem(key);
          const item = JSON.parse(data);
          if (item && item.expire < now) {
            localStorage.removeItem(key);
          }
        }
      });
    } else if (this.options.storage === 'sessionStorage') {
      const keys = Object.keys(sessionStorage);
      keys.forEach(key => {
        if (key.startsWith(this.options.prefix)) {
          const data = sessionStorage.getItem(key);
          const item = JSON.parse(data);
          if (item && item.expire < now) {
            sessionStorage.removeItem(key);
          }
        }
      });
    } else {
      this.cache.forEach((item, key) => {
        if (item.expire < now) {
          this.cache.delete(key);
        }
      });
    }
  }
  
  loadFromStorage() {
    const keys = Object.keys(localStorage);
    keys.forEach(key => {
      if (key.startsWith(this.options.prefix)) {
        const data = localStorage.getItem(key);
        const item = JSON.parse(data);
        this.cache.set(key.slice(this.options.prefix.length), item);
      }
    });
  }
}
```
