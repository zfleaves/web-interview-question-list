# 8. 如何实现一个高性能的虚拟列表？

**答案：**

```javascript
class InfiniteScroll {
  constructor() {
    this.state = {
      items: [],
      page: 1,
      loading: false,
      hasMore: true
    };
    
    this.init();
  }
  
  init() {
    this.loadItems();
    window.addEventListener('scroll', this.handleScroll);
  }
  
  loadItems = async () => {
    if (this.state.loading || !this.state.hasMore) return;
    
    this.state.loading = true;
    
    try {
      const { page } = this.state;
      const newItems = await this.fetchItems(page);
      
      this.state.items = [...this.state.items, ...newItems];
      this.state.page = page + 1;
      this.state.loading = false;
      this.state.hasMore = newItems.length >= 10;
      
      this.render();
    } catch (error) {
      console.error(error);
      this.state.loading = false;
    }
  };
  
  fetchItems = async (page) => {
    const response = await fetch(`/api/items?page=${page}`);
    const data = await response.json();
    return data;
  };
  
  handleScroll = () => {
    const { scrollTop, scrollHeight, clientHeight } = document.documentElement;
    
    if (scrollTop + clientHeight >= scrollHeight - 100) {
      this.loadItems();
    }
  };
  
  render() {
    const container = document.getElementById('container');
    container.innerHTML = `
      <ul>
        ${this.state.items.map((item, index) => `
          <li key="${index}">${item.name}</li>
        `).join('')}
      </ul>
      ${this.state.loading ? '<div>加载中...</div>' : ''}
    `;
  }
}
```
