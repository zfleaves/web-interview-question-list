## 8. 如何实现深拷贝？

**答案：**

### 方法 1：JSON 序列化

```javascript
function deepClone(obj) {
  return JSON.parse(JSON.stringify(obj));
}

const obj = {
  name: 'John',
  age: 30,
  address: {
    city: 'New York',
    country: 'USA'
  }
};

const cloned = deepClone(obj);
console.log(cloned); // { name: 'John', age: 30, address: { city: 'New York', country: 'USA' } }

// 缺点：无法拷贝函数、Symbol、undefined
```

### 方法 2：递归

```javascript
function deepClone(obj, hash = new WeakMap()) {
  // 处理基本类型和 null
  if (obj === null || typeof obj !== 'object') {
    return obj;
  }
  
  // 处理循环引用
  if (hash.has(obj)) {
    return hash.get(obj);
  }
  
  // 处理日期
  if (obj instanceof Date) {
    return new Date(obj);
  }
  
  // 处理正则
  if (obj instanceof RegExp) {
    return new RegExp(obj);
  }
  
  // 处理数组
  if (Array.isArray(obj)) {
    const cloned = [];
    hash.set(obj, cloned);
    for (const item of obj) {
      cloned.push(deepClone(item, hash));
    }
    return cloned;
  }
  
  // 处理对象
  const cloned = {};
  hash.set(obj, cloned);
  for (const key in obj) {
    if (obj.hasOwnProperty(key)) {
      cloned[key] = deepClone(obj[key], hash);
    }
  }
  
  return cloned;
}

const obj = {
  name: 'John',
  age: 30,
  address: {
    city: 'New York',
    country: 'USA'
  },
  hobbies: ['reading', 'coding']
};

const cloned = deepClone(obj);
console.log(cloned);
```

### 方法 3：使用 structuredClone（现代浏览器）

```javascript
function deepClone(obj) {
  return structuredClone(obj);
}

const obj = {
  name: 'John',
  age: 30,
  address: {
    city: 'New York',
    country: 'USA'
  }
};

const cloned = deepClone(obj);
console.log(cloned);
```

---