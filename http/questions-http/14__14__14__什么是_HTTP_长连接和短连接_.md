## 14.  什么是 HTTP 长连接和短连接？

**答案：**

### 短连接

**原理：** 每次请求都建立一个新的 TCP 连接，请求完成后关闭连接。

```
请求1 --> 建立连接 --> 发送请求 --> 接收响应 --> 关闭连接
请求2 --> 建立连接 --> 发送请求 --> 接收响应 --> 关闭连接
请求3 --> 建立连接 --> 发送请求 --> 接收响应 --> 关闭连接
```

**优点：**
- 简单
- 服务器资源占用少

**缺点：**
- 每次请求都需要建立连接，延迟高
- TCP 握手开销大

**配置：**

```javascript
// HTTP/1.0 默认使用短连接
Connection: close
```

### 长连接

**原理：** 一个 TCP 连接可以发送多个请求，请求完成后不关闭连接。

```
建立连接 --> 请求1 --> 响应1 --> 请求2 --> 响应2 --> 请求3 --> 响应3 --> 关闭连接
```

**优点：**
- 减少 TCP 握手次数，延迟低
- 提高资源利用率

**缺点：**
- 服务器资源占用多
- 需要管理连接状态

**配置：**

```javascript
// HTTP/1.1 默认使用长连接
Connection: keep-alive

// 设置超时时间
Keep-Alive: timeout=60, max=100
```

### 长连接 vs 短连接

| 特性 | 短连接 | 长连接 |
|------|--------|--------|
| 连接次数 | 每次请求都建立连接 | 多个请求共享连接 |
| 延迟 | 高 | 低 |
| 服务器资源 | 少 | 多 |
| 适用场景 | 低并发、低频率请求 | 高并发、高频率请求 |

### 实际应用

```nginx
# nginx 配置长连接
keepalive_timeout 65;
keepalive_requests 100;
```

```javascript
// Node.js Express
app.use((req, res, next) => {
  res.setHeader('Connection', 'keep-alive');
  next();
});
```

---