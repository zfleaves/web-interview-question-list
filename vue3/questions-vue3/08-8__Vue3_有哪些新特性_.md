# 8. Vue3 有哪些新特性？

**答案：**

**1. Teleport（传送门）：**

```javascript
// 基本用法
<Teleport to="body">
  <div class="modal">Modal</div>
</Teleport>

// 传送到指定选择器
<Teleport to="#modal-container">
  <div class="modal">Modal</div>
</Teleport>

// 条件禁用
<Teleport to="body" :disabled="isInline">
  <div class="modal">Modal</div>
</Teleport>

// 多个 Teleport
<Teleport to="body">
  <div class="toast">Toast 1</div>
</Teleport>
<Teleport to="body">
  <div class="toast">Toast 2</div>
</Teleport>
```

**2. Suspense（异步组件）：**

```javascript
// 基本用法
<Suspense>
  <template #default>
    <AsyncComponent />
  </template>
  <template #fallback>
    <Loading />
  </template>
</Suspense>

// 嵌套使用
<Suspense>
  <template #default>
    <AsyncParent>
      <Suspense>
        <template #default>
          <AsyncChild />
        </template>
        <template #fallback>
          <ChildLoading />
        </template>
      </Suspense>
    </AsyncParent>
  </template>
  <template #fallback>
    <ParentLoading />
  </template>
</Suspense>

// 异步组件定义
const AsyncComponent = defineAsyncComponent({
  loader: () => import('./AsyncComponent.vue'),
  loadingComponent: LoadingComponent,
  errorComponent: ErrorComponent,
  delay: 200,
  timeout: 3000
});
```

**3. Fragment（多根节点）：**

```javascript
// Vue2: 必须有唯一根节点
<template>
  <div>
    <header>Header</header>
    <main>Main</main>
    <footer>Footer</footer>
  </div>
</template>

// Vue3: 支持多个根节点
<template>
  <header>Header</header>
  <main>Main</main>
  <footer>Footer</footer>
</template>

// 带条件渲染
<template>
  <header>Header</header>
  <main v-if="showMain">Main</main>
  <footer>Footer</footer>
</template>
```

**4. 自定义指令改进：**

```javascript
// Vue2
Vue.directive('focus', {
  inserted(el) {
    el.focus();
  }
});

// Vue3
const app = createApp(App);

app.directive('focus', {
  mounted(el) {
    el.focus();
  }
});

// 生命周期钩子变化
// Vue2              Vue3
// bind         ->   beforeMount
// inserted     ->   mounted
// update       ->   beforeUpdate
// componentUpdated -> updated
// unbind       ->   unmounted

// 完整示例
app.directive('my-directive', {
  created(el, binding, vnode, prevVnode) {
    console.log('created');
  },
  beforeMount(el, binding, vnode, prevVnode) {
    console.log('beforeMount');
  },
  mounted(el, binding, vnode, prevVnode) {
    console.log('mounted');
  },
  beforeUpdate(el, binding, vnode, prevVnode) {
    console.log('beforeUpdate');
  },
  updated(el, binding, vnode, prevVnode) {
    console.log('updated');
  },
  beforeUnmount(el, binding, vnode, prevVnode) {
    console.log('beforeUnmount');
  },
  unmounted(el, binding, vnode, prevVnode) {
    console.log('unmounted');
  }
});

// 简写形式
app.directive('focus', (el, binding) => {
  el.focus();
});
```

**5. Transition 改进：**

```javascript
// Vue2
<transition name="fade">
  <div v-if="show">Content</div>
</transition>

// Vue3: 支持 v-if、v-show、v-for 的过渡
<Transition>
  <div v-if="show">Content</div>
</Transition>

<TransitionGroup>
  <div v-for="item in list" :key="item.id">{{ item.text }}</div>
</TransitionGroup>

// TypeScript 支持
import { Transition, TransitionGroup } from 'vue';

// 自定义过渡类名
<Transition
  enter-active-class="animate__animated animate__bounce"
  leave-active-class="animate__animated animate__bounceOutRight"
>
  <div v-if="show">Content</div>
</Transition>

// JavaScript 钩子
<Transition
  @before-enter="onBeforeEnter"
  @enter="onEnter"
  @after-enter="onAfterEnter"
  @before-leave="onBeforeLeave"
  @leave="onLeave"
  @after-leave="onAfterLeave"
>
  <div v-if="show">Content</div>
</Transition>
```

**6. 全局 API 改变：**

```javascript
// Vue2
import Vue from 'vue';
import VueRouter from 'vue-router';
import Vuex from 'vuex';

Vue.use(VueRouter);
Vue.use(Vuex);

Vue.prototype.$http = axios;
Vue.component('my-component', MyComponent);
Vue.directive('my-directive', myDirective);
Vue.mixin(myMixin);

new Vue({
  router,
  store,
  render: h => h(App)
}).$mount('#app');

// Vue3
import { createApp } from 'vue';
import App from './App.vue';
import router from './router';
import store from './store';

const app = createApp(App);

app.use(router);
app.use(store);

app.config.globalProperties.$http = axios;
app.component('my-component', MyComponent);
app.directive('my-directive', myDirective);
app.mixin(myMixin);

app.mount('#app');

// 优势：
// 1. 避免全局污染
// 2. 支持多个 Vue 实例
// 3. 更好的 Tree-shaking
```
