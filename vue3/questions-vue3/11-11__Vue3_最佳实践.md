# 11. Vue3 最佳实践

**答案：**

**1. 使用 Composition API 组织代码：**

```javascript
// 按功能组织代码
<script setup>
import { ref, computed } from 'vue';

// 用户相关
const user = ref(null);
const userName = computed(() => user.value?.name);
const loadUser = async () => {
  user.value = await fetchUser();
};

// 搜索相关
const searchQuery = ref('');
const searchResults = ref([]);
const search = async () => {
  searchResults.value = await searchAPI(searchQuery.value);
};

// 分页相关
const currentPage = ref(1);
const pageSize = ref(10);
const totalPages = computed(() => Math.ceil(searchResults.value.length / pageSize.value));

// 初始化
onMounted(() => {
  loadUser();
});
</script>
```

**2. 使用自定义 Hook 复用逻辑：**

```javascript
// usePagination.js
import { ref, computed } from 'vue';

export function usePagination(items, pageSize = 10) {
  const currentPage = ref(1);
  const totalPages = computed(() => Math.ceil(items.value.length / pageSize));
  
  const paginatedItems = computed(() => {
    const start = (currentPage.value - 1) * pageSize;
    const end = start + pageSize;
    return items.value.slice(start, end);
  });
  
  const nextPage = () => {
    if (currentPage.value < totalPages.value) {
      currentPage.value++;
    }
  };
  
  const prevPage = () => {
    if (currentPage.value > 1) {
      currentPage.value--;
    }
  };
  
  return {
    currentPage,
    totalPages,
    paginatedItems,
    nextPage,
    prevPage
  };
}

// 使用
<script setup>
import { usePagination } from './usePagination';

const items = ref([...]);
const { currentPage, paginatedItems, nextPage, prevPage } = usePagination(items);
</script>
```

**3. 使用 TypeScript：**

```javascript
<script setup lang="ts">
interface User {
  id: number;
  name: string;
  email: string;
}

interface Props {
  userId: number;
  showEmail?: boolean;
}

interface Emits {
  (e: 'update', user: User): void;
  (e: 'delete', id: number): void;
}

const props = withDefaults(defineProps<Props>(), {
  showEmail: false
});

const emit = defineEmits<Emits>();

const user = ref<User | null>(null);

const loadUser = async (): Promise<void> => {
  user.value = await fetchUser(props.userId);
};

const handleUpdate = (): void => {
  if (user.value) {
    emit('update', user.value);
  }
};
</script>
```

**4. 使用 Pinia 替代 Vuex：**

```javascript
// store/user.ts
import { defineStore } from 'pinia';

export const useUserStore = defineStore('user', {
  state: () => ({
    user: null as User | null,
    token: ''
  }),
  
  getters: {
    isLoggedIn: (state) => !!state.token,
    userName: (state) => state.user?.name || ''
  },
  
  actions: {
    async login(credentials: LoginCredentials) {
      const response = await api.login(credentials);
      this.user = response.user;
      this.token = response.token;
    },
    
    logout() {
      this.user = null;
      this.token = '';
    }
  }
});

// 使用
<script setup>
import { useUserStore } from '@/stores/user';

const userStore = useUserStore();

const handleLogin = async () => {
  await userStore.login({ username, password });
};
</script>
```

**5. 使用 Teleport 处理弹窗：**

```javascript
<template>
  <Teleport to="body">
    <div v-if="showModal" class="modal-overlay" @click="closeModal">
      <div class="modal-content" @click.stop>
        <slot />
        <button @click="closeModal">Close</button>
      </div>
    </div>
  </Teleport>
</template>

<script setup>
const props = defineProps({
  showModal: Boolean
});

const emit = defineEmits(['close']);

const closeModal = () => {
  emit('close');
};
</script>
```
