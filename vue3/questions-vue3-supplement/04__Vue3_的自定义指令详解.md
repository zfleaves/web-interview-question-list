# Vue3 的自定义指令详解

**答案：**

## 如何定义

```javascript
const app = createApp({});

// 注册全局指令
app.directive('focus', {
  mounted(el) {
    el.focus();
  }
});

// 局部注册
export default {
  directives: {
    focus: {
      mounted(el) {
        el.focus();
      }
    }
  }
};
```

## 生命周期钩子

```javascript
app.directive('my-directive', {
  // 在绑定元素的 attribute 前
  created(el, binding, vnode, prevVnode) {},
  // 在元素被插入到 DOM 前调用
  beforeMount(el, binding, vnode, prevVnode) {},
  // 在元素被插入到 DOM 后调用
  mounted(el, binding, vnode, prevVnode) {},
  // 在更新前调用
  beforeUpdate(el, binding, vnode, prevVnode) {},
  // 更新后调用
  updated(el, binding, vnode, prevVnode) {},
  // 在卸载前调用
  beforeUnmount(el, binding, vnode, prevVnode) {},
  // 在卸载后调用
  unmounted(el, binding, vnode, prevVnode) {}
});
```

## 简写

```javascript
// 相当于 mounted 和 updated
app.directive('color', (el, binding) => {
  el.style.color = binding.value;
});
```

## 实现复制到剪贴板

```javascript
app.directive('copy', {
  mounted(el, binding) {
    el.addEventListener('click', () => {
      navigator.clipboard.writeText(binding.value);
    });
  }
});
```

## 实现无限滚动

```javascript
app.directive('infinite-scroll', {
  mounted(el, binding) {
    const callback = binding.value;
    el.addEventListener('scroll', () => {
      if (el.scrollTop + el.clientHeight >= el.scrollHeight - 10) {
        callback();
      }
    });
  }
});
```

## 实现权限控制

```javascript
app.directive('permission', {
  mounted(el, binding) {
    const permissions = binding.value;
    if (!hasPermission(permissions)) {
      el.parentNode?.removeChild(el);
    }
  }
});
```

---