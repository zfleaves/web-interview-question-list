# 13. Vue2 性能优化有哪些方法？

**答案：**

**1. v-if vs v-show：**

```javascript
// v-if: 适合条件很少改变的场景
<div v-if="showDetail">Detail</div>

// v-show: 适合频繁切换的场景
<div v-show="isVisible">Content</div>
```

**2. v-for 使用 key：**

```javascript
// ✅ 使用唯一 ID
<li v-for="item in items" :key="item.id">
  {{ item.name }}
</li>

// ❌ 避免使用 index
<li v-for="(item, index) in items" :key="index">
  {{ item.name }}
</li>
```

**3. 合理使用 computed：**

```javascript
// ✅ 使用 computed 缓存计算结果
computed: {
  filteredList() {
    return this.list.filter(item => item.active);
  }
}

// ❌ 避免在模板中使用复杂表达式
<div>{{ list.filter(item => item.active).map(item => item.name).join(', ') }}</div>
```

**4. 事件监听优化：**

```javascript
// ✅ 使用事件委托
<div @click="handleItemClick">
  <div v-for="item in items" :data-id="item.id">{{ item.name }}</div>
</div>

methods: {
  handleItemClick(e) {
    const id = e.target.dataset.id;
    // 处理点击
  }
}

// ✅ 使用防抖/节流
import { debounce } from 'lodash';

methods: {
  handleSearch: debounce(function(query) {
    this.search(query);
  }, 300)
}
```

**5. 组件懒加载：**

```javascript
// 路由懒加载
const routes = [
  {
    path: '/about',
    component: () => import('@/views/About.vue')
  }
];

// 组件懒加载
components: {
  HeavyComponent: () => import('@/components/HeavyComponent.vue')
}
```

**6. 长列表优化（虚拟滚动）：**

```javascript
// 使用 vue-virtual-scroll-list
import VirtualList from 'vue-virtual-scroll-list';

<VirtualList
  :size="50"
  :remain="8"
  :data="list"
>
  <item slot-scope="props" :item="props.item" />
</VirtualList>
```

**7. 图片懒加载：**

```javascript
// 使用 vue-lazyload
import VueLazyload from 'vue-lazyload';

Vue.use(VueLazyload, {
  preLoad: 1.3,
  error: 'error.png',
  loading: 'loading.png',
  attempt: 1
});

// 使用
<img v-lazy="imageSrc">
```

**8. keep-alive 缓存组件：**

```javascript
// 缓存组件状态
<keep-alive>
  <component :is="currentComponent"></component>
</keep-alive>

// 缓存指定组件
<keep-alive include="Home,About">
  <component :is="currentComponent"></component>
</keep-alive>

// 排除指定组件
<keep-alive exclude="Admin">
  <component :is="currentComponent"></component>
</keep-alive>

// 组件内使用
export default {
  activated() {
    // 组件被激活时调用
  },
  deactivated() {
    // 组件被停用时调用
  }
};
```

**9. 减少响应式数据：**

```javascript
// ✅ 使用 Object.freeze 冻结不需要响应式的数据
data() {
  return {
    staticList: Object.freeze(largeStaticList)
  };
}

// ✅ 使用非响应式属性
export default {
  created() {
    this.nonReactiveData = largeData;
  }
};
```

**10. 使用 v-once：**

```javascript
// 只渲染一次，不更新
<div v-once>{{ staticContent }}</div>
```

**11. 合理使用 Vuex：**

```javascript
// ✅ 模块化
const store = new Vuex.Store({
  modules: {
    user: userModule,
    product: productModule
  }
});

// ✅ 使用 local state
export default {
  data() {
    return {
      localState: '只在组件内使用'
    };
  }
};
```

**12. 优化渲染函数：**

```javascript
// 使用函数式组件
Vue.component('functional-component', {
  functional: true,
  render(h, context) {
    return h('div', context.props.message);
  }
});
```
