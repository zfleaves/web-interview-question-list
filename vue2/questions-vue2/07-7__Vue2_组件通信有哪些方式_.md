# 7. Vue2 组件通信有哪些方式？

**答案：**

**1. Props / $emit（父子通信）：**

```javascript
// 父组件
<template>
  <child-component
    :message="parentMessage"
    @update="handleUpdate"
  />
</template>

<script>
export default {
  data() {
    return {
      parentMessage: 'Hello from parent'
    };
  },
  methods: {
    handleUpdate(newMessage) {
      this.parentMessage = newMessage;
    }
  }
};
</script>

// 子组件
<template>
  <div>
    <p>{{ message }}</p>
    <button @click="sendMessage">Send to Parent</button>
  </div>
</template>

<script>
export default {
  props: {
    message: {
      type: String,
      required: true
    }
  },
  methods: {
    sendMessage() {
      this.$emit('update', 'Hello from child');
    }
  }
};
</script>
```

**2. $refs（父访问子）：**

```javascript
// 父组件
<template>
  <child-component ref="child" />
  <button @click="callChildMethod">Call Child Method</button>
</template>

<script>
export default {
  methods: {
    callChildMethod() {
      this.$refs.child.childMethod();
    }
  }
};
</script>

// 子组件
<script>
export default {
  methods: {
    childMethod() {
      console.log('Child method called');
    }
  }
};
</script>
```

**3. $parent / $children（子访问父）：**

```javascript
// 子组件访问父组件
this.$parent.parentMethod();

// 父组件访问所有子组件
this.$children.forEach(child => {
  child.childMethod();
});
```

**4. Provide / Inject（跨层级通信）：**

```javascript
// 祖先组件
export default {
  provide() {
    return {
      theme: this.theme,
      updateTheme: this.updateTheme
    };
  },
  data() {
    return {
      theme: 'light'
    };
  },
  methods: {
    updateTheme(newTheme) {
      this.theme = newTheme;
    }
  }
};

// 后代组件
export default {
  inject: ['theme', 'updateTheme'],
  methods: {
    changeTheme() {
      this.updateTheme('dark');
    }
  }
};
```

**5. Event Bus（兄弟组件通信）：**

```javascript
// event-bus.js
import Vue from 'vue';
export const EventBus = new Vue();

// 组件 A
import { EventBus } from './event-bus';

export default {
  methods: {
    sendMessage() {
      EventBus.$emit('message', 'Hello from A');
    }
  }
};

// 组件 B
import { EventBus } from './event-bus';

export default {
  created() {
    EventBus.$on('message', (message) => {
      console.log('Received:', message);
    });
  },
  beforeDestroy() {
    EventBus.$off('message');
  }
};
```

**6. Vuex（状态管理）：**

```javascript
// store.js
import Vue from 'vue';
import Vuex from 'vuex';

Vue.use(Vuex);

export default new Vuex.Store({
  state: {
    count: 0
  },
  mutations: {
    increment(state) {
      state.count++;
    }
  },
  actions: {
    asyncIncrement({ commit }) {
      setTimeout(() => {
        commit('increment');
      }, 1000);
    }
  },
  getters: {
    doubleCount: state => state.count * 2
  }
});

// 组件中使用
export default {
  computed: {
    count() {
      return this.$store.state.count;
    },
    doubleCount() {
      return this.$store.getters.doubleCount;
    }
  },
  methods: {
    increment() {
      this.$store.commit('increment');
    },
    asyncIncrement() {
      this.$store.dispatch('asyncIncrement');
    }
  }
};
```

**7. $attrs / $listeners（透传属性和事件）：**

```javascript
// 父组件
<base-input
  v-model="value"
  placeholder="Enter text"
  @focus="handleFocus"
/>

// BaseInput 组件
<template>
  <input
    v-bind="$attrs"
    v-on="$listeners"
    v-model="inputValue"
  />
</template>

<script>
export default {
  inheritAttrs: false, // 不继承 attributes 到根元素
  props: ['value'],
  computed: {
    inputValue: {
      get() {
        return this.value;
      },
      set(value) {
        this.$emit('input', value);
      }
    }
  }
};
</script>
```

**8. Slot（插槽通信）：**

```javascript
// 父组件
<child-component>
  <template v-slot:header>
    <h1>Header Content</h1>
  </template>
  <template v-slot:default="{ user }">
    <p>{{ user.name }}</p>
  </template>
  <template #footer>
    <p>Footer Content</p>
  </template>
</child-component>

// 子组件
<template>
  <div>
    <slot name="header"></slot>
    <slot :user="currentUser"></slot>
    <slot name="footer"></slot>
  </div>
</template>
```
