# 8. Vue2 的生命周期有哪些？各个阶段的作用是什么？

**答案：**

**生命周期钩子：**

```javascript
export default {
  // 1. 创建阶段
  beforeCreate() {
    // 实例初始化之后，数据观测和事件配置之前
    // 此时无法访问 data、methods、computed
    console.log('beforeCreate');
  },
  
  created() {
    // 实例创建完成，数据观测、属性和方法运算已完成
    // 可以访问 data、methods、computed
    // DOM 还未挂载
    console.log('created');
    // 常用于：初始化数据、发起异步请求
  },
  
  // 2. 挂载阶段
  beforeMount() {
    // 挂载开始之前，render 函数首次被调用
    // 虚拟 DOM 已创建，但还未挂载到真实 DOM
    console.log('beforeMount');
  },
  
  mounted() {
    // 实例已挂载到 DOM
    // 可以访问 DOM 元素
    // 常用于：操作 DOM、使用第三方库
    console.log('mounted');
    this.$refs.myElement.focus();
  },
  
  // 3. 更新阶段
  beforeUpdate() {
    // 数据变化，DOM 更新之前
    // 可以在此访问更新前的 DOM
    console.log('beforeUpdate');
  },
  
  updated() {
    // DOM 已更新
    // 可以访问更新后的 DOM
    // 注意：避免在此修改状态，可能导致无限循环
    console.log('updated');
  },
  
  // 4. 销毁阶段
  beforeDestroy() {
    // 实例销毁之前
    // 实例仍然完全可用
    // 常用于：清理定时器、解绑事件、取消订阅
    console.log('beforeDestroy');
    clearInterval(this.timer);
  },
  
  destroyed() {
    // 实例已销毁
    // 所有指令解绑，所有事件监听器移除
    console.log('destroyed');
  },
  
  // 5. 错误捕获
  errorCaptured(err, vm, info) {
    // 捕获子孙组件的错误
    console.error('Error captured:', err);
    // 返回 false 可以阻止错误继续向上传播
    return false;
  }
};
```

**生命周期图示：**

```
beforeCreate
    ↓
created
    ↓
beforeMount
    ↓
mounted
    ↓
beforeUpdate ←→ updated
    ↓
beforeDestroy
    ↓
destroyed
```

**父子组件生命周期执行顺序：**

```javascript
// 加载过程
Parent beforeCreate
Parent created
Parent beforeMount
  Child beforeCreate
  Child created
  Child beforeMount
  Child mounted
Parent mounted

// 更新过程
Parent beforeUpdate
  Child beforeUpdate
  Child updated
Parent updated

// 销毁过程
Parent beforeDestroy
  Child beforeDestroy
  Child destroyed
Parent destroyed
```

**使用场景：**

```javascript
export default {
  created() {
    // ✅ 初始化数据
    this.initData();
    
    // ✅ 发起异步请求
    this.fetchData();
    
    // ✅ 订阅事件
    this.eventBus.$on('event', this.handleEvent);
  },
  
  mounted() {
    // ✅ 操作 DOM
    this.$refs.chart.initChart();
    
    // ✅ 使用第三方库
    this.$refs.editor = new Editor(this.$refs.editor);
  },
  
  beforeDestroy() {
    // ✅ 清理定时器
    clearInterval(this.timer);
    
    // ✅ 解绑事件
    this.eventBus.$off('event', this.handleEvent);
    
    // ✅ 取消订阅
    this.subscription.unsubscribe();
    
    // ✅ 销毁第三方实例
    this.$refs.chart.destroy();
  }
};
```
