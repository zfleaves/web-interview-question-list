## 3. 小程序的双向绑定原理是什么？

**答案：**

小程序的双向绑定是通过 `setData` 实现的。

### 基本用法

```javascript
Page({
  data: {
    message: 'Hello',
    user: {
      name: 'John',
      age: 18
    }
  },
  
  // 修改数据
  changeMessage() {
    this.setData({
      message: 'World'
    });
  },
  
  // 修改对象属性
  changeUserName() {
    this.setData({
      'user.name': 'Jane'
    });
  }
});
```

### WXML 双向绑定

```xml
<!-- 单向绑定 -->
<view>{{message}}</view>

<!-- 双向绑定 -->
<input model:value="{{message}}" />

<!-- 对象属性双向绑定 -->
<input model:value="{{user.name}}" />
```

### 原理

1. **数据更新**：调用 `setData` 更新数据
2. **虚拟 DOM 对比**：对比新旧虚拟 DOM 树
3. **差异更新**：只更新变化的部分
4. **视图更新**：将差异应用到真实 DOM

```javascript
// setData 实现原理（简化版）
function setData(data) {
  // 1. 合并数据
  const newData = Object.assign(this.data, data);
  
  // 2. 生成新的虚拟 DOM
  const newVNode = render(newData);
  
  // 3. 对比差异
  const patches = diff(this.vnode, newVNode);
  
  // 4. 应用差异
  patch(this.$el, patches);
  
  // 5. 更新数据
  this.data = newData;
  this.vnode = newVNode;
}
```

---